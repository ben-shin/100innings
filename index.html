<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>100 Innings Logger</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #111;
      color: #eee;
    }

    h1 {
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .state {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1.05rem;
    }

    .box {
      padding: 0.5rem;
      background: #222;
      border-radius: 6px;
      text-align: center;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    button {
      font-size: 0.95rem;
      padding: 0.7rem;
      border: none;
      border-radius: 6px;
      background: #444;
      color: white;
    }

    button:active {
      background: #666;
    }

    #bases {
      display: flex;
      justify-content: space-around;
      margin-top: 0.5rem;
    }

    #bases button {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      font-size: 0.85rem;
    }

    .footer {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }
  </style>
</head>

<body>

<h1>100 Innings Logger</h1>

<div class="state">
  <div class="box" id="inningBox"></div>
  <div class="box" id="scoreBox"></div>
  <div class="box" id="outsBox"></div>
  <div class="box" id="countBox"></div>

  <div class="box">
    Bases
    <div id="bases">
      <button onclick="toggleBase(1)">1B</button>
      <button onclick="toggleBase(2)">2B</button>
      <button onclick="toggleBase(3)">3B</button>
    </div>
  </div>
</div>

<div class="buttons">
  <button onclick="ball()">BALL</button>
  <button onclick="strike()">STRIKE</button>
  <button onclick="foul()">FOUL</button>

  <button onclick="hit()">HIT</button>
  <button onclick="outInPlay()">OUT</button>
  <button onclick="stealAttempt()">STEAL</button>

  <button onclick="pickoff()">PICKOFF</button>
  <button onclick="throwdown()">THROWDOWN</button>
  <button onclick="errorOnly()">ERROR</button>
</div>

<div class="footer">
  <button onclick="undo()">UNDO</button>
  <button onclick="exportLog()">EXPORT DAY</button>
</div>

<script>
/* ================= STATE ================= */

let gameState = JSON.parse(localStorage.getItem("gameState")) || {
  inning: 1,
  half: "top",
  balls: 0,
  strikes: 0,
  outs: 0,
  runners: [false, false, false],
  score: { away: 0, home: 0 },
  events: []
};

/* ================= UTIL ================= */

function save() {
  localStorage.setItem("gameState", JSON.stringify(gameState));
}

function logEvent(type, details = {}) {
  gameState.events.push({
    time: new Date().toISOString(),
    inning: gameState.inning,
    half: gameState.half,
    type,
    details
  });
  save();
  render();
}

function resetCount() {
  gameState.balls = 0;
  gameState.strikes = 0;
}

function scoreRun() {
  if (gameState.half === "top") gameState.score.away++;
  else gameState.score.home++;
}

function nextHalfInning() {
  gameState.outs = 0;
  resetCount();
  gameState.runners = [false, false, false];
  gameState.half = gameState.half === "top" ? "bottom" : "top";
  if (gameState.half === "top") gameState.inning++;
}

/* ================= RUNNERS ================= */

function toggleBase(base) {
  gameState.runners[base - 1] = !gameState.runners[base - 1];
  logEvent("runner_toggle", { base });
}

function advanceRunners(bases) {
  const newRunners = [false, false, false];

  for (let i = 2; i >= 0; i--) {
    if (gameState.runners[i]) {
      const dest = i + bases;
      if (dest >= 3) scoreRun();
      else newRunners[dest] = true;
    }
  }
  gameState.runners = newRunners;
}

/* ================= PITCHES ================= */

function ball() {
  if (gameState.balls >= 3) {
    logEvent("walk");
    advanceRunners(1);
    gameState.runners[0] = true;
    resetCount();
  } else {
    gameState.balls++;
    logEvent("ball");
  }
}

function strike() {
  if (gameState.strikes >= 2) {
    logEvent("strikeout");
    gameState.outs++;
    resetCount();
    if (gameState.outs >= 3) nextHalfInning();
  } else {
    gameState.strikes++;
    logEvent("strike");
  }
}

function foul() {
  if (gameState.strikes < 2) gameState.strikes++;
  logEvent("foul");
}

/* ================= HIT WORKFLOW ================= */

function hit() {
  const type = prompt("Hit type? (1B, 2B, 3B, HR)", "1B");
  if (!type) return;

  const basesMap = { "1B": 1, "2B": 2, "3B": 3, "HR": 4 };
  const batterBases = basesMap[type.toUpperCase()];
  if (!batterBases) return alert("Invalid hit.");

  const runnerAdvance = parseInt(
    prompt("How many bases did runners advance?", "1"),
    10
  );

  if (isNaN(runnerAdvance)) return alert("Invalid number.");

  const isError = confirm("Was there an error on the play?");

  logEvent("hit", {
    hitType: type.toUpperCase(),
    runnerAdvance,
    error: isError
  });

  if (batterBases === 4) {
    gameState.runners.forEach(r => r && scoreRun());
    scoreRun(); // batter
    gameState.runners = [false, false, false];
  } else {
    advanceRunners(runnerAdvance);
    if (batterBases - 1 >= 3) scoreRun();
    else gameState.runners[batterBases - 1] = true;
  }

  resetCount();
}

/* ================= DEFENSE ================= */

function outInPlay() {
  logEvent("out_in_play");
  gameState.outs++;
  resetCount();
  if (gameState.outs >= 3) nextHalfInning();
}

function stealAttempt() {
  const success = confirm("Steal successful?");
  logEvent("steal_attempt", { success });

  if (!success) {
    gameState.outs++;
    if (gameState.outs >= 3) nextHalfInning();
  }
}

function pickoff() {
  const base = parseInt(prompt("Pickoff attempt at which base? (1,2,3)", "1"), 10);
  if (![1,2,3].includes(base)) return;

  const out = confirm("Runner out?");
  logEvent("pickoff", { base, out });

  if (out && gameState.runners[base - 1]) {
    gameState.runners[base - 1] = false;
    gameState.outs++;
    if (gameState.outs >= 3) nextHalfInning();
  }
}

function throwdown() {
  const base = parseInt(prompt("Throwdown to which base? (2 or 3)", "2"), 10);
  if (![2,3].includes(base)) return;

  const out = confirm("Runner out?");
  logEvent("throwdown", { base, out });

  if (out && gameState.runners[base - 2]) {
    gameState.runners[base - 2] = false;
    gameState.outs++;
    if (gameState.outs >= 3) nextHalfInning();
  }
}

function errorOnly() {
  logEvent("error");
}

/* ================= UNDO / EXPORT ================= */

function undo() {
  gameState.events.pop();
  rebuildFromEvents();
}

function rebuildFromEvents() {
  const events = [...gameState.events];

  gameState = {
    inning: 1,
    half: "top",
    balls: 0,
    strikes: 0,
    outs: 0,
    runners: [false, false, false],
    score: { away: 0, home: 0 },
    events: []
  };

  events.forEach(e => {
    gameState.inning = e.inning;
    gameState.half = e.half;
    gameState.events.push(e);
  });

  save();
  render();
}

function exportLog() {
  const blob = new Blob(
    [JSON.stringify(gameState.events, null, 2)],
    { type: "application/json" }
  );
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "day-events.json";
  a.click();
}

/* ================= RENDER ================= */

function render() {
  document.getElementById("inningBox").textContent =
    `Inning ${gameState.inning} — ${gameState.half}`;

  document.getElementById("scoreBox").textContent =
    `Away ${gameState.score.away} — Home ${gameState.score.home}`;

  document.getElementById("outsBox").textContent =
    `Outs: ${gameState.outs}`;

  document.getElementById("countBox").textContent =
    `Count: ${gameState.balls}-${gameState.strikes}`;

  document.querySelectorAll("#bases button").forEach((btn, i) => {
    btn.style.background = gameState.runners[i] ? "#0a0" : "#444";
  });
}

render();
</script>

</body>
</html>
